---
title: å¦‚ä½•ç”¨Pythonå¿«é€Ÿæ’¸å‡ºä¸€ä¸ªè´´å§å›¾ç‰‡ä¸‹è½½å™¨
date: 2016-04-23 17:11:43
tags: 
  - Python
  - è´´å§
  - Image
---


è¿™æ˜¯ä¸€ç¯‡å…³äºè‡ªå·±å†™è´´å§å›¾ç‰‡ä¸‹è½½å™¨çš„æ€»ç»“ã€‚
ã€€	
èµ·åˆæ˜¯å®¤å‹è¯´è¦åšä¸€ä¸ªè´´å§çš„ä¿¡æ¯æ”¶é›†çˆ¬è™«ï¼Œäºæ˜¯æ‰“ç®—å…ˆä»ç®€å•ä¸€ç‚¹çš„å¼€å§‹ï¼Œå…ˆåšä¸€ä¸ªè´´å§çš„å›¾ç‰‡ä¸‹è½½å§ï¼Œä¹‹åå†æŠŠè·å–å›¾ç‰‡æ”¹æˆè·å–èƒŒçš„å†…å®¹ä¸å°±å¥½äº†å˜›ğŸ˜„ï¼Œç„¶åå°±å¼€å§‹å†™äº†è¿™ä¸ªçˆ¬è™«ã€‚ç°åœ¨è¿™ä¸ªPythonè„šæœ¬ä¸»è¦ç”¨åˆ°äº†ä¸‹é¢çš„ä¸€äº›ä¸œè¥¿ã€‚
ã€€	
### ç”¨åˆ°çš„Pythonæ¨¡å—
- requestsï¼ˆPythonä¸‹çš„HTTPå®¢æˆ·ç«¯å®ç°ï¼‰
- BeautifulSoupï¼ˆä¸€ä¸ªå¾ˆæ–¹ä¾¿çš„htmlè¯­æ³•åˆ†æå·¥å…·ï¼‰
- coloramaï¼ˆåœ¨æ§åˆ¶å°è¾“å‡ºå½©è‰²çš„
- threadingï¼ˆæˆ‘ç”¨åˆ°äº†å¤šçº¿ç¨‹çš„ä¸€äº›ä¸œè¥¿ï¼‰
- signalï¼ˆPythonä¸‹å’Œä¿¡å·ç›¸å…³çš„ä¸œè¥¿ï¼‰
- OptionParserï¼ˆå¾ˆæ–¹ä¾¿çš„å‘½ä»¤è¡Œå‚æ•°é…ç½®å·¥å…·ï¼‰
- threadpoolï¼ˆä¸€ä¸ªèŠè‹£å†™çš„Pythonçº¿ç¨‹æ± å®ç°ï¼‰

### åŸç†çš„éƒ¨åˆ†

å…¶å®æ€è·¯å¾ˆç®€å•ï¼Œéšä¾¿æ‰¾ä¸€ä¸ªå¸–å­ï¼Œæ¯”å¦‚è¿™ä¸ª<http://tieba.baidu.com/p/2545680017>ï¼Œè¿™æ˜¯ä¸€ä¸ªå›¾æ¥¼ï¼Œç„¶åå°±éœ€è¦åˆ†æé¡µé¢çš„HTMä»£ç å†…å®¹ï¼Œæˆ‘ç”¨çš„æ˜¯Chromeæµè§ˆå™¨ï¼Œé‚£å°±å³é”®é€‰æ‹©ä¸€ä¸ªæ¥¼å±‚çš„å›¾ç‰‡ï¼Œ`å®¡æŸ¥å…ƒç´ `ï¼Œç„¶åå‘ç°HTMLä»£ç ä¸­æ˜¯è¿™æ ·å†™çš„ï¼š
ã€€	
```HTML
<img class="BDE_Image" src="http://imgsrc.baidu.com/forum/w%3D580/sign=198d73cadc54564ee565e43183dc9cde/857f1f1f95cad1c8f75fb3fe7e3e6709c83d5130.jpg" pic_ext="jpeg" width="550" height="600">
```
ã€€	
å¯ä»¥çœ‹åˆ°é‡Œé¢`src`éƒ¨åˆ†ç›´æ¥æ˜¯å›¾ç‰‡çš„åœ°å€ï¼Œå†è§‚å¯Ÿæ¥¼å±‚å›¾ç‰‡å’Œå…¶ä»–æ— å…³ç´§è¦çš„å›¾ç‰‡ï¼ˆæ¯”å¦‚å±‚ä¸»å¤´åƒã€ç­¾åæ¡£ï¼‰çš„å†™æ³•åŒºåˆ«ï¼Œå‘ç°æ¥¼å±‚å›¾ç‰‡éƒ½ä¼šæœ‰ä¸€ä¸ª`BDE_Image`classï¼Œé‚£ä¹ˆè¿™å°±å¥½åŠäº†ï¼Œç­‰ä¼šç›´æ¥ç­›é€‰å‡ºæ¥å°±å¥½ã€‚

ç„¶åç¿»åˆ°å¸–å­çš„ç¬¬äºŒé¡µï¼Œå‘ç°URLå˜æˆäº†<http://tieba.baidu.com/p/2545680017?pn=2>ï¼Œå¤šäº†ä¸€ä¸ª`?pn=2`ï¼Œè¿™ä¸ª`pn`å‚æ•°ä¹Ÿå°±è¡¨ç¤ºäº†å½“å‰æŸ¥çœ‹çš„é¡µæ•°ä½ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦çŸ¥é“å¸–å­æ€»å…±æœ‰å¤šå°‘é¡µï¼Œå¯¹`pn`åšä¸€ä¸ªéå†å°±å¯ä»¥è·å¾—ä¸€ä¸ªå¸–å­ä¸­æ‰€æœ‰é¡µé¢äº†ï¼Œç°åœ¨éœ€è¦çŸ¥é“æ€ä¹ˆè·å–å¸–å­çš„æ€»é¡µé¢æ•°ã€‚ç›´æ¥æ¥åˆ°å¸–å­çš„æœ€åº•éƒ¨ï¼Œçœ‹åˆ°äº†è¿™æ ·çš„å†…å®¹`62å›å¤è´´ï¼Œå…±3é¡µ`ï¼Œå¯¹åº”çš„HTMLä»£ç ä¸ºï¼š
ã€€	
```HTML
<li class="l_reply_num" style="margin-left:8px"><span class="red" style="margin-right:3px">62</span>å›å¤è´´ï¼Œå…±<span class="red">3</span>é¡µ</li>
```
ã€€	
ç‰¹å¾å¾ˆæ˜æ˜¾ï¼Œæœ‰ä¸€ä¸ªå«åš`l_reply_num`çš„classï¼Œæ€»å›å¸–æ•°å’Œæ€»é¡µæ•°éƒ½å„ç”¨ä¸€ä¸ªsapnæ ‡ç­¾åŒ…èµ·æ¥äº†ï¼Œç­‰ä¼šç›´æ¥è¿‡æ»¤å‡ºæ¥å°±å¯ä»¥ã€‚

ç°åœ¨å¯¹ç½‘é¡µéƒ¨åˆ†çš„åˆ†æç®—æ˜¯ç»“æŸäº†ï¼Œåˆ°äº†ä»£ç å®ç°çš„éƒ¨åˆ†äº†ã€‚

### è¿™é‡Œè´´å‡ºéƒ¨åˆ†ä»£ç 

```Python
# ç”¨requestsæ¨¡å—ç›´æ¥è·å–ç½‘é¡µçš„HTMLå†…å®¹
getparams = {'pn': 1}
result_ = requests.get('http://tieba.baidu.com/p/2545680017?', params=getparams).content
```

```Python
# ç”¨BeautifulSoupæ¨¡å—åšHTMLå†…å®¹çš„åˆ†æï¼Œè·å–æ€»é¡µæ•°
soup = BeautifulSoup(result_, 'lxml')
page_list = soup.find('li', attrs={'class': 'l_reply_num'})
max_page_number = int(page_list.contents[2].string)  # æ€»é¡µæ•°
```

```Python
# åœ¨pnå¤„åšä¸€ä¸ªéå†ï¼Œè·å–åˆ°å¸–å­çš„æ‰€æœ‰é¡µé¢
for pageNum in range(start, end):
    getparams = {'pn': pageNum}
    html_cont = requests.get(self.pURL, params=getparams).content
    soup = BeautifulSoup(html_cont, 'lxml')
    # ç”¨BeautifulSoupæ¨¡å—åšHTMLå†…å®¹çš„åˆ†æï¼Œè·å–åˆ°æ‰€æœ‰æ¥¼å±‚å›¾ç‰‡çš„ä¸‹è½½åœ°å€
    # å¹¶å‘é€åˆ°ä¸‹è½½é˜Ÿåˆ—
    for item in soup.findAll('img', attrs={'class': "BDE_Image"}):
        srcurl = item.get('src')  # å›¾ç‰‡åœ°å€
        if not self._is_Exit:
            self.downloader.add_task(srcurl)
```

```Python
# ä¸‹è½½å™¨é‡Œç”¨threadpoolæ¨¡å—åšå¤šçº¿ç¨‹çš„å¹¶å‘ä¸‹è½½ï¼Œè¿™æ ·é€Ÿåº¦æ¯”å•çº¿ç¨‹å¿«å¾ˆå¤š
def add_task(self, url):
    with self.lock:
        self._is_alive = True
    reqs = threadpool.makeRequests(self._download, [url, ], self._callback)
    [self.threadPool.putRequest(req, timeout=1) for req in reqs]
```

```Python
# ç›´æ¥ç”¨requestsæ¨¡å—å®Œæˆå›¾ç‰‡çš„ä¸‹è½½ï¼Œå¹¶ä¿å­˜åˆ°æ–‡ä»¶
def _download(self, url):
    if self.is_alive():
        r = requests.request('GET', url)
        if r:
            filename = os.path.join(self.save_directory, os.path.basename(url))  # æ‹¼æ¥æ–‡ä»¶å
            if not os.path.exists(filename):
                with open(filename, 'wb') as f:
                    f.write(r.content)  # ä¿å­˜å›¾ç‰‡
                return 1
            else:
                return -1
    else:
        return None
```

### é€Ÿåº¦è¿˜ä¸é”™
ã€€	
{% asset_img tiebaImageGet-010.png resImghere %}

### END

åˆ°è¿™é‡Œå…¶å®å…³é”®çš„éƒ¨åˆ†ä¹Ÿå°±ç»“æŸäº†ï¼Œå‰©ä¸‹çš„ä¸€äº›å¾®å°çš„å·¥ä½œï¼Œæ¯”å¦‚è¾“å‡ºç»Ÿè®¡ç»“æœï¼ˆä¸‹äº†å¤šå°‘å›¾ï¼Œç”¨äº†å¤šå°‘æ—¶é—´ï¼Œæ”¯æŒè®¾ç½®ä¿å­˜ç›®å½•ã€‚ã€‚ã€‚ï¼‰ï¼Œå„ä½çœ‹å®˜æ„Ÿå…´è¶£çš„è¯å¯ä»¥ç›´æ¥å»æˆ‘çš„Githubä¸Šçœ‹æºç ã€‚

Github <https://github.com/zhaohui8969/tiebaImageGet>
